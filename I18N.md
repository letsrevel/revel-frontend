# Internationalization (i18n) Guide

Revel supports multiple languages using **Paraglide.js** by inlang. This guide covers how our i18n system works and how to maintain translations.

## ğŸ“š Table of Contents

- [Supported Languages](#supported-languages)
- [Architecture](#architecture)
- [Adding Translations](#adding-translations)
- [Using Translations in Code](#using-translations-in-code)
- [Translation Workflow](#translation-workflow)
- [Validation & Quality](#validation--quality)
- [Common Issues](#common-issues)

## ğŸŒ Supported Languages

| Language | Code | Status      | Completion        |
| -------- | ---- | ----------- | ----------------- |
| English  | `en` | âœ… Source   | 100% (1,394 keys) |
| German   | `de` | âœ… Complete | 100% (1,394 keys) |
| Italian  | `it` | âœ… Complete | 100% (1,394 keys) |

## ğŸ—ï¸ Architecture

### Files & Directories

```
revel-frontend/
â”œâ”€â”€ messages/                    # Translation files (source of truth)
â”‚   â”œâ”€â”€ en.json                 # English (source language)
â”‚   â”œâ”€â”€ de.json                 # German translations
â”‚   â””â”€â”€ it.json                 # Italian translations
â”œâ”€â”€ src/lib/paraglide/          # Generated runtime (DO NOT EDIT)
â”‚   â”œâ”€â”€ messages.js             # Auto-generated message functions
â”‚   â”œâ”€â”€ runtime.js              # Auto-generated runtime
â”‚   â””â”€â”€ ...
â”œâ”€â”€ src/lib/i18n.ts             # i18n configuration & language detection
â”œâ”€â”€ src/hooks.server.ts         # Server-side language setup
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ validate-translations.js # Translation validation script
â””â”€â”€ project.inlang/
    â””â”€â”€ settings.json           # Inlang project configuration
```

### How It Works

1. **Translation files** (`messages/*.json`) contain key-value pairs in nested JSON
2. **Paraglide compiler** generates TypeScript-safe message functions
3. **Language detection** happens server-side (URL â†’ Cookie â†’ Accept-Language â†’ Default)
4. **Components** import and call message functions to get translated strings

## âœï¸ Adding Translations

### Step 1: Add Keys to English (Source)

Always start with English (`messages/en.json`):

```json
{
	"myFeature": {
		"title": "My Feature",
		"description": "This is a great feature",
		"action": "Click here to {action}"
	}
}
```

**Key Guidelines:**

- Use `camelCase` for keys
- Group related keys under namespaces
- Use placeholders in `{curlyBraces}` for dynamic content
- Keep keys semantic, not literal (e.g., `user.greeting` not `user.helloText`)

### Step 2: Translate to Other Languages

Add the **same keys** to `de.json` and `it.json`:

```json
// messages/de.json
{
	"myFeature": {
		"title": "Meine Funktion",
		"description": "Das ist eine groÃŸartige Funktion",
		"action": "Klicke hier um zu {action}"
	}
}
```

```json
// messages/it.json
{
	"myFeature": {
		"title": "La Mia FunzionalitÃ ",
		"description": "Questa Ã¨ una grande funzionalitÃ ",
		"action": "Clicca qui per {action}"
	}
}
```

### Step 3: Compile & Validate

```bash
# Compile translations and validate
pnpm i18n:compile

# Or run separately:
pnpm paraglide:compile
pnpm i18n:validate
```

## ğŸ’» Using Translations in Code

### In Svelte Components

```svelte
<script lang="ts">
	import * as m from '$lib/paraglide/messages.js';

	let userName = 'Alice';
</script>

<!-- Simple translation -->
<h1>{m.myFeature.title()}</h1>

<!-- With placeholders -->
<p>{m.myFeature.action({ action: 'continue' })}</p>

<!-- Dynamic selection -->
<button>{m[`button.${type}`]()}</button>
```

### In TypeScript/JavaScript

```typescript
import * as m from '$lib/paraglide/messages.js';

// Simple translation
const title = m.myFeature.title();

// With placeholders
const message = m.welcome.greeting({ name: 'Alice' });

// With pluralization (using custom logic)
const count = 5;
const label = count === 1 ? m.common.plurals.event() : m.common.plurals.events();
```

### In Server-Side Code

```typescript
// +page.server.ts
import * as m from '$lib/paraglide/messages.js';
import { setLocale } from '$lib/i18n';

export const load = async ({ locals, cookies }) => {
	// Locale is already set by hooks.server.ts
	const greeting = m.welcome.greeting({ name: locals.user?.firstName || 'Guest' });

	return { greeting };
};
```

## ğŸ”„ Translation Workflow

### For Developers

1. **Add English keys** to `messages/en.json`
2. **Run validation** to ensure structure is correct:
   ```bash
   pnpm i18n:validate
   ```
3. **Create a translation task** for German & Italian (or add them yourself)
4. **Compile translations**:
   ```bash
   pnpm paraglide:compile
   ```
5. **Commit all files** (messages/_.json AND src/lib/paraglide/_)

### For Translators

1. **Never modify** `messages/en.json` (English is source of truth)
2. **Only edit** `messages/de.json` or `messages/it.json`
3. **Match keys exactly** - same structure as English
4. **Preserve placeholders** - `{name}`, `{count}`, etc. must stay identical
5. **Test translations** by running the validation script:
   ```bash
   node scripts/validate-translations.js
   ```

### Pre-Commit Hook

The pre-commit hook automatically:

- âœ… Validates translations when message files change
- âœ… Recompiles Paraglide runtime
- âœ… Stages generated files

If validation fails, the commit is blocked until fixed.

## ğŸ” Validation & Quality

### Validation Script

Run the validation script to check:

- âœ… All languages have the same keys
- âœ… No empty strings
- âœ… Placeholders are consistent
- âœ… JSON is valid

```bash
pnpm i18n:validate
```

### What Gets Checked

1. **Key Count**: All languages must have exactly 1,394 keys
2. **Key Structure**: Same nested structure across all languages
3. **Empty Strings**: No translation can be an empty string (`""`)
4. **Placeholder Consistency**: Same `{placeholders}` in all translations
5. **JSON Validity**: Files must be valid JSON

### CI/CD Integration

GitHub Actions automatically validates translations on every push and PR:

- Runs validation script
- Checks JSON formatting
- Ensures compilation succeeds

## ğŸš¨ Common Issues

### Issue: "Missing key" in German/Italian

**Problem**: English has a key that German/Italian doesn't
**Solution**: Add the missing key to the target language file

```bash
# Find missing keys
pnpm i18n:validate
```

### Issue: "Empty string" validation error

**Problem**: Translation key exists but has no value (`""`)
**Solution**: Add a translation for that key

```json
// âŒ Bad
"myKey": ""

// âœ… Good
"myKey": "My translation"
```

### Issue: "Placeholder mismatch" warning

**Problem**: English has `{name}` but German has `{username}`
**Solution**: Use the **exact same placeholder names**

```json
// English
"greeting": "Hello {name}!"

// âŒ Bad German
"greeting": "Hallo {username}!"

// âœ… Good German
"greeting": "Hallo {name}!"
```

### Issue: Translations not updating in browser

**Problem**: Paraglide runtime not recompiled
**Solution**:

```bash
pnpm paraglide:compile
# Then restart dev server
pnpm dev
```

### Issue: TypeScript errors after adding keys

**Problem**: TypeScript doesn't see new message functions
**Solution**: Recompile and restart TypeScript server

```bash
pnpm paraglide:compile
# In VS Code: Cmd+Shift+P â†’ "TypeScript: Restart TS Server"
```

## ğŸ¨ Translation Style Guidelines

### Formality

- **English**: Casual, friendly tone
- **German**: Use "Sie" (formal) for user-facing text, "du" (informal) for helper text
- **Italian**: Use "tu" (informal) throughout - matches existing style

### Punctuation

- **Dates**: Use locale-appropriate formats (EN: "Oct 17, 2025", DE: "17. Okt. 2025", IT: "17 ott 2025")
- **Times**: 12-hour (EN) vs 24-hour (DE, IT) where appropriate
- **Currency**: Always use symbols and codes (â‚¬, $, USD, EUR)

### Technical Terms

Keep these terms in English across all languages:

- RSVP
- QR code
- Email
- Staff
- Admin
- Markdown
- API

### Accessibility

- Keep `aria-label` translations clear and descriptive
- Maintain semantic meaning, not literal translation
- Test with screen readers in target language if possible

## ğŸ“Š Statistics

Current translation coverage:

```bash
# Run this to see live stats
pnpm i18n:validate
```

**Total Keys**: 1,394
**Languages**: 3 (English, German, Italian)
**Completion**: 100% across all languages âœ¨

## ğŸ› ï¸ Maintenance

### Adding a New Language

1. Add language code to `project.inlang/settings.json`:

   ```json
   {
   	"languageTags": ["en", "de", "it", "fr"] // Add "fr"
   }
   ```

2. Create `messages/fr.json` by copying `messages/en.json`

3. Translate all keys

4. Update language switcher in `src/lib/components/common/LanguageSwitcher.svelte`

5. Recompile:
   ```bash
   pnpm paraglide:compile
   ```

### Updating Translations

1. Edit `messages/<lang>.json`
2. Run validation: `pnpm i18n:validate`
3. Recompile: `pnpm paraglide:compile`
4. Test in browser
5. Commit changes

### Removing a Language

1. Delete `messages/<lang>.json`
2. Remove from `project.inlang/settings.json`
3. Update language switcher component
4. Recompile: `pnpm paraglide:compile`

## ğŸ”— Resources

- [Paraglide.js Documentation](https://inlang.com/m/gerre34r/library-inlang-paraglideJs)
- [Inlang Project](https://inlang.com/)
- [Translation Files](./messages/)
- [Language Switcher Component](./src/lib/components/common/LanguageSwitcher.svelte)
- [i18n Configuration](./src/lib/i18n.ts)

## ğŸ¯ Quality Standards

To maintain **10/10 i18n quality**:

- âœ… **100% completion** across all languages
- âœ… **Zero empty strings**
- âœ… **Consistent placeholders**
- âœ… **Automated validation** in CI/CD
- âœ… **Pre-commit hooks** prevent bad commits
- âœ… **Clear documentation** (this file!)
- âœ… **Semantic keys** that make sense
- âœ… **Professional translations** reviewed by native speakers
- âœ… **Regular audits** of translation quality
- âœ… **Accessibility** considered in all translations

---

**Need help?** Check the [validation script](./scripts/validate-translations.js) or run `pnpm i18n:validate` for detailed error messages.
