#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Check if translation files were modified
translation_files=$(git diff --cached --name-only --diff-filter=ACM | grep "^messages/.*\.json$")

if [ -n "$translation_files" ]; then
  echo "ğŸŒ Translation files changed, validating..."

  # Validate translations
  if ! node scripts/validate-translations.js; then
    echo ""
    echo "âŒ Translation validation failed!"
    echo "Fix the issues above before committing."
    exit 1
  fi

  echo "âœ… Translation validation passed!"

  # Recompile translations
  echo "ğŸ”„ Recompiling translations..."
  if ! pnpm paraglide:compile; then
    echo "âŒ Failed to compile translations!"
    exit 1
  fi

  # Stage the compiled files
  git add src/lib/paraglide/

  echo "âœ… Translations compiled and staged!"
fi

# Run linters on staged files
pnpm lint-staged
